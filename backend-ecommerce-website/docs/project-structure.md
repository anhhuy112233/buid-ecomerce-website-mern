# üìÅ Project Structure - C·∫•u Tr√∫c D·ª± √Ån

H∆∞·ªõng d·∫´n chi ti·∫øt v·ªÅ c·∫•u tr√∫c th∆∞ m·ª•c v√† file trong d·ª± √°n E-commerce Backend.

## üéØ T·ªïng Quan

D·ª± √°n ƒë∆∞·ª£c t·ªï ch·ª©c theo m√¥ h√¨nh **MVC (Model-View-Controller)** v·ªõi ki·∫øn tr√∫c **layered architecture** ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh b·∫£o tr√¨ v√† m·ªü r·ªông.

## üìÇ C·∫•u Tr√∫c Th∆∞ M·ª•c

```
backend-ecommerce-website/
‚îú‚îÄ‚îÄ üìÅ src/                          # Source code ch√≠nh
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ config/                   # C·∫•u h√¨nh
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ controllers/              # Controllers (Business Logic)
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ middleware/               # Custom Middleware
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ models/                   # Database Models
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ routes/                   # API Routes
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ services/                 # Business Services
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ uploads/                  # Uploaded Files
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ utils/                    # Utility Functions
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ index.js                  # Entry Point
‚îú‚îÄ‚îÄ üìÅ docs/                         # Documentation
‚îú‚îÄ‚îÄ üìÅ tests/                        # Test Files
‚îú‚îÄ‚îÄ üìÑ .env                          # Environment Variables
‚îú‚îÄ‚îÄ üìÑ .env.example                  # Environment Template
‚îú‚îÄ‚îÄ üìÑ .gitignore                    # Git Ignore Rules
‚îú‚îÄ‚îÄ üìÑ package.json                  # Dependencies & Scripts
‚îú‚îÄ‚îÄ üìÑ package-lock.json             # Locked Dependencies
‚îî‚îÄ‚îÄ üìÑ README.md                     # Project README
```

## üîç Chi Ti·∫øt T·ª´ng Th∆∞ M·ª•c

### üìÅ `src/` - Source Code Ch√≠nh

#### üìÅ `config/` - C·∫•u H√¨nh
```
config/
‚îú‚îÄ‚îÄ üìÑ db.js                         # Database configuration
‚îú‚îÄ‚îÄ üìÑ jwt.js                        # JWT configuration
‚îî‚îÄ‚îÄ üìÑ multer.js                     # File upload configuration
```

**M·ª•c ƒë√≠ch**: Ch·ª©a t·∫•t c·∫£ c·∫•u h√¨nh c·ªßa ·ª©ng d·ª•ng
- **db.js**: C·∫•u h√¨nh k·∫øt n·ªëi MongoDB
- **jwt.js**: C·∫•u h√¨nh JWT tokens
- **multer.js**: C·∫•u h√¨nh file upload

#### üìÅ `controllers/` - Controllers
```
controllers/
‚îú‚îÄ‚îÄ üìÑ ProductController.js          # Product CRUD operations
‚îú‚îÄ‚îÄ üìÑ UserController.js             # User CRUD operations
‚îî‚îÄ‚îÄ üìÑ OrderController.js            # Order CRUD operations
```

**M·ª•c ƒë√≠ch**: X·ª≠ l√Ω HTTP requests v√† responses
- Nh·∫≠n request t·ª´ routes
- Validate input data
- G·ªçi services ƒë·ªÉ x·ª≠ l√Ω business logic
- Tr·∫£ v·ªÅ response cho client

**V√≠ d·ª•**:
```javascript
// ProductController.js
const createProduct = async (req, res) => {
  try {
    const result = await ProductService.createProduct(req.body);
    return res.status(200).json(result);
  } catch (error) {
    return res.status(500).json({
      status: "ERR",
      message: error.message
    });
  }
};
```

#### üìÅ `middleware/` - Custom Middleware
```
middleware/
‚îú‚îÄ‚îÄ üìÑ authMiddleware.js             # Authentication middleware
‚îú‚îÄ‚îÄ üìÑ errorMiddleware.js            # Error handling middleware
‚îî‚îÄ‚îÄ üìÑ validationMiddleware.js       # Input validation middleware
```

**M·ª•c ƒë√≠ch**: X·ª≠ l√Ω c√°c t√°c v·ª• trung gian
- **authMiddleware.js**: X√°c th·ª±c JWT tokens
- **errorMiddleware.js**: X·ª≠ l√Ω l·ªói global
- **validationMiddleware.js**: Validate input data

**V√≠ d·ª•**:
```javascript
// authMiddleware.js
const authenticate = async (req, res, next) => {
  try {
    const token = req.headers.authorization?.split(' ')[1];
    if (!token) {
      return res.status(401).json({ message: 'No token provided' });
    }
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    req.user = decoded;
    next();
  } catch (error) {
    return res.status(401).json({ message: 'Invalid token' });
  }
};
```

#### üìÅ `models/` - Database Models
```
models/
‚îú‚îÄ‚îÄ üìÑ ProductModel.js               # Product schema
‚îú‚îÄ‚îÄ üìÑ UserModel.js                  # User schema
‚îú‚îÄ‚îÄ üìÑ OrderModel.js                 # Order schema
‚îî‚îÄ‚îÄ üìÑ OrderProduct.js               # Order-Product relationship
```

**M·ª•c ƒë√≠ch**: ƒê·ªãnh nghƒ©a database schemas
- S·ª≠ d·ª•ng Mongoose ƒë·ªÉ ƒë·ªãnh nghƒ©a schemas
- Validation rules
- Indexes v√† relationships

**V√≠ d·ª•**:
```javascript
// ProductModel.js
const productSchema = new mongoose.Schema({
  name: { type: String, required: true, unique: true },
  price: { type: Number, required: true },
  description: { type: String, required: true },
  // ... other fields
}, {
  timestamps: true
});
```

#### üìÅ `routes/` - API Routes
```
routes/
‚îú‚îÄ‚îÄ üìÑ index.js                      # Main router
‚îú‚îÄ‚îÄ üìÑ ProductRouter.js              # Product routes
‚îú‚îÄ‚îÄ üìÑ UserRouter.js                 # User routes
‚îî‚îÄ‚îÄ üìÑ OrderRouter.js                # Order routes
```

**M·ª•c ƒë√≠ch**: ƒê·ªãnh nghƒ©a API endpoints
- URL patterns
- HTTP methods
- Controller mapping

**V√≠ d·ª•**:
```javascript
// ProductRouter.js
router.post('/create-product', ProductController.createProduct);
router.get('/get-all', ProductController.getAllProducts);
router.get('/get-details/:id', ProductController.getProductById);
router.put('/update/:id', ProductController.updateProduct);
router.delete('/delete/:id', ProductController.deleteProduct);
```

#### üìÅ `services/` - Business Services
```
services/
‚îú‚îÄ‚îÄ üìÑ ProductService.js             # Product business logic
‚îú‚îÄ‚îÄ üìÑ UserService.js                # User business logic
‚îú‚îÄ‚îÄ üìÑ JwtService.js                 # JWT operations
‚îî‚îÄ‚îÄ üìÑ EmailService.js               # Email operations
```

**M·ª•c ƒë√≠ch**: Ch·ª©a business logic
- X·ª≠ l√Ω nghi·ªáp v·ª• ph·ª©c t·∫°p
- Database operations
- External API calls

**V√≠ d·ª•**:
```javascript
// ProductService.js
const createProduct = async (productData) => {
  try {
    const existingProduct = await Product.findOne({ name: productData.name });
    if (existingProduct) {
      throw new Error("Product already exists");
    }
    
    const newProduct = new Product(productData);
    await newProduct.save();
    
    return {
      status: "OK",
      message: "Product created successfully",
      data: newProduct
    };
  } catch (error) {
    throw error;
  }
};
```

#### üìÅ `uploads/` - Uploaded Files
```
uploads/
‚îú‚îÄ‚îÄ üìÅ images/                       # Product images
‚îú‚îÄ‚îÄ üìÅ avatars/                      # User avatars
‚îî‚îÄ‚îÄ üìÅ documents/                    # Other documents
```

**M·ª•c ƒë√≠ch**: L∆∞u tr·ªØ files ƒë∆∞·ª£c upload
- Product images
- User avatars
- Documents

#### üìÅ `utils/` - Utility Functions
```
utils/
‚îú‚îÄ‚îÄ üìÑ logger.js                     # Logging utility
‚îú‚îÄ‚îÄ üìÑ validator.js                  # Validation utility
‚îú‚îÄ‚îÄ üìÑ helper.js                     # Helper functions
‚îî‚îÄ‚îÄ üìÑ constants.js                  # Constants
```

**M·ª•c ƒë√≠ch**: C√°c h√†m ti·ªán √≠ch
- Logging functions
- Validation helpers
- Common utilities

### üìÅ `docs/` - Documentation
```
docs/
‚îú‚îÄ‚îÄ üìÑ README.md                     # Main documentation
‚îú‚îÄ‚îÄ üìÑ installation-guide.md         # Installation guide
‚îú‚îÄ‚îÄ üìÑ dependencies-guide.md         # Dependencies guide
‚îú‚îÄ‚îÄ üìÑ project-structure.md          # This file
‚îú‚îÄ‚îÄ üìÅ features/                     # Feature documentation
‚îú‚îÄ‚îÄ üìÅ testing/                      # Testing documentation
‚îú‚îÄ‚îÄ üìÅ deployment/                   # Deployment documentation
‚îî‚îÄ‚îÄ üìÅ maintenance/                  # Maintenance documentation
```

### üìÅ `tests/` - Test Files
```
tests/
‚îú‚îÄ‚îÄ üìÅ unit/                         # Unit tests
‚îú‚îÄ‚îÄ üìÅ integration/                  # Integration tests
‚îú‚îÄ‚îÄ üìÅ api/                          # API tests
‚îî‚îÄ‚îÄ üìÑ setup.js                      # Test setup
```

## üîÑ Lu·ªìng D·ªØ Li·ªáu

### 1. **Request Flow**
```
Client Request ‚Üí Routes ‚Üí Middleware ‚Üí Controller ‚Üí Service ‚Üí Model ‚Üí Database
```

### 2. **Response Flow**
```
Database ‚Üí Model ‚Üí Service ‚Üí Controller ‚Üí Middleware ‚Üí Routes ‚Üí Client Response
```

### 3. **Error Flow**
```
Error ‚Üí Service ‚Üí Controller ‚Üí Error Middleware ‚Üí Client Error Response
```

## üìã File Quan Tr·ªçng

### üìÑ `src/index.js` - Entry Point
```javascript
const express = require('express');
const cors = require('cors');
require('dotenv').config();

const app = express();

// Middleware
app.use(cors());
app.use(express.json());

// Routes
app.use('/api/products', require('./routes/ProductRouter'));
app.use('/api/users', require('./routes/UserRouter'));

// Error handling
app.use(errorMiddleware);

const PORT = process.env.PORT || 8080;
app.listen(PORT, () => {
  console.log(`Server running on port ${PORT}`);
});
```

### üìÑ `package.json` - Project Configuration
```json
{
  "name": "ecommerce-backend",
  "version": "1.0.0",
  "description": "E-commerce Backend API",
  "main": "src/index.js",
  "scripts": {
    "start": "node src/index.js",
    "dev": "nodemon src/index.js",
    "test": "jest"
  },
  "dependencies": {
    "express": "^4.18.2",
    "mongoose": "^7.5.0",
    "bcrypt": "^5.1.0",
    "jsonwebtoken": "^9.0.2"
  }
}
```

### üìÑ `.env` - Environment Variables
```env
# Server Configuration
PORT=8080
NODE_ENV=development

# Database Configuration
MONGODB_URI=mongodb://localhost:27017/ecommerce_db

# JWT Configuration
JWT_SECRET=your-secret-key
JWT_EXPIRES_IN=24h

# File Upload Configuration
UPLOAD_PATH=./uploads
MAX_FILE_SIZE=5242880
```

## üèóÔ∏è Ki·∫øn Tr√∫c Patterns

### 1. **MVC Pattern**
- **Model**: Database schemas v√† data access
- **View**: API responses (JSON)
- **Controller**: Request handling v√† business logic coordination

### 2. **Service Layer Pattern**
- T√°ch business logic kh·ªèi controllers
- Reusable business operations
- Easier testing v√† maintenance

### 3. **Middleware Pattern**
- Modular request processing
- Cross-cutting concerns
- Authentication, logging, validation

### 4. **Repository Pattern** (C√≥ th·ªÉ m·ªü r·ªông)
- Abstract data access layer
- Database agnostic
- Easier testing

## üîß Best Practices

### 1. **File Naming**
- Use PascalCase for models: `UserModel.js`
- Use camelCase for controllers: `userController.js`
- Use kebab-case for routes: `user-router.js`

### 2. **Import/Export**
```javascript
// Use named exports
export const createUser = async (userData) => { ... };
export const getUserById = async (id) => { ... };

// Use default exports for main modules
export default router;
```

### 3. **Error Handling**
```javascript
// Consistent error format
const errorResponse = {
  status: "ERR",
  message: error.message,
  timestamp: new Date().toISOString()
};
```

### 4. **Configuration Management**
```javascript
// Centralized configuration
const config = {
  database: {
    uri: process.env.MONGODB_URI,
    options: { useNewUrlParser: true }
  },
  jwt: {
    secret: process.env.JWT_SECRET,
    expiresIn: process.env.JWT_EXPIRES_IN
  }
};
```

## üìà Scalability Considerations

### 1. **Modular Structure**
- Easy to add new features
- Independent modules
- Clear separation of concerns

### 2. **Configuration Management**
- Environment-based configuration
- Centralized settings
- Easy deployment

### 3. **Error Handling**
- Global error handling
- Consistent error responses
- Proper logging

### 4. **Testing Structure**
- Unit tests for services
- Integration tests for APIs
- Separate test environment

## üöÄ Deployment Structure

### Development
```
src/
‚îú‚îÄ‚îÄ üìÅ config/
‚îú‚îÄ‚îÄ üìÅ controllers/
‚îú‚îÄ‚îÄ üìÅ middleware/
‚îú‚îÄ‚îÄ üìÅ models/
‚îú‚îÄ‚îÄ üìÅ routes/
‚îú‚îÄ‚îÄ üìÅ services/
‚îî‚îÄ‚îÄ üìÑ index.js
```

### Production
```
dist/                    # Compiled code
‚îú‚îÄ‚îÄ üìÅ config/
‚îú‚îÄ‚îÄ üìÅ controllers/
‚îú‚îÄ‚îÄ üìÅ middleware/
‚îú‚îÄ‚îÄ üìÅ models/
‚îú‚îÄ‚îÄ üìÅ routes/
‚îú‚îÄ‚îÄ üìÅ services/
‚îî‚îÄ‚îÄ üìÑ index.js
```

---

**L∆∞u √Ω**: C·∫•u tr√∫c n√†y ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ d·ªÖ b·∫£o tr√¨ v√† m·ªü r·ªông. H√£y tu√¢n th·ªß c√°c conventions ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh nh·∫•t qu√°n!
